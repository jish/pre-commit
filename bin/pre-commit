#!/usr/bin/env ruby

require 'fileutils'

PRE_COMMIT_HOOK_PATH = '.git/hooks/pre-commit'

if ARGV[0] != "install"
  puts "Usage: pre-commit install"
  exit(1)
end

if !File.exists?(".git")
  puts "No .git directory found."
  exit(1)
end

# TODO overwrite and backup?
if File.exists?(PRE_COMMIT_HOOK_PATH)
  puts "Not overwriting existing hook: #{PRE_COMMIT_HOOK_PATH}"
  exit(1)
end

pre_commit_hook = File.expand_path('../../templates/pre-commit-hook', __FILE__)
FileUtils.cp(pre_commit_hook, PRE_COMMIT_HOOK_PATH)
FileUtils.chmod(0755, PRE_COMMIT_HOOK_PATH)

puts "Installed hook: #{PRE_COMMIT_HOOK_PATH}"
